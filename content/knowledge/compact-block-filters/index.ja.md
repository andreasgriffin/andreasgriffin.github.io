---
title: "コンパクトブロックフィルター"
description: "コンパクトブロックフィルターが何か、そしてElectrumサーバーと比べてどのようにプライバシーを向上させるかを理解する。"
draft: false
tags: ["Featured", "Knowledge" ]
images: ["logo.jpg" ]
keywords:
  - "Bitcoin Safe"
  - "コンパクトブロックフィルター"
  - "CBF"
  - "プライバシー"
  - "ビットコインウォレット"
  - "Bitcoin Core"
  - "BDK"
weight: 0
---

## {{< page-title >}}


Bitcoin Safe   1.6.0では、ウォレットを同期するオプションとして**コンパクトブロックフィルター（CBF）**を導入しました。中央集権的なElectrumサーバーにウォレット履歴を問い合わせる代わりに、Bitcoin SafeはランダムなBitcoin Coreピアから各ブロックの小さな要約ファイルを直接ダウンロードできます。これらの要約は短いチェックリストのように機能し、ウォレット自身がそのブロックにあなたの取引が含まれている可能性があるかどうかを判断できます。

Bitcoin Safeが判断をローカルで行うため、サードパーティのサーバーがどのアドレスや取引をあなたが気にしているかを知ることは決してありません。フルノードが保持するのと同じ確認データを、日常のデバイスに適した軽量な形式で受け取ることができます。

**なぜより良く感じるのか：**

- 📦 **小さなダウンロード量：** 各フィルターは数キロバイト程度しかないため、ブロックチェーン全体を保存せずに通常の家庭用回線で同期できます。
- 🔐 **ネットワークから直接取得：** Bitcoin Safeは複数のランダムなBitcoin Coreノードと通信します。他のノードと同様の方法で動作するため、単一の観測者にプロファイリングされる可能性を減らします。
- 🕵️ **ローカルでの照合：** フィルターはローカルでウォレットがチェックします。フィルターが関連ありと判断した場合にのみ該当ブロックを取得するため、あなたのアドレスを秘匿できます。

これに対してElectrumサーバーはユーザーに代わってブロックチェーンを検索します。すべてのリクエストはウォレットのアドレスをサーバー運営者と共有するため、運営者がその情報を記録する可能性があります。コンパクトブロックフィルターを使うことで、Bitcoin Safeは各ノードが共有する中立的なデータをダウンロードします。ウォレットが最初からアドレスを明かさないため、誰もどのアドレスがあなたのものであるかを判断できません。

Below is a simple view of how [Bitcoin Safe]({{< ref "/" >}}) connects when CBF is enabled. Notice how it mirrors the way Bitcoin Core nodes already talk to each other:


![Bitcoin Safe downloads compact block filters from several random Bitcoin Core peers.](logo.jpg)
{ .img-fluid .mb-5   style="max-width: 450px;" }


Bitcoin Safeが接続するピア数は選択できます。ピア数が多いほど帯域幅を多く使い、同期に時間がかかる場合があります。デフォルトは2です。  

 
### 同期時に期待すること

CBFは、行っている操作に応じて待ち時間が変わります：

1. ✨ **ウォレットの設定または復元：** 新しいウォレットを作成する場合でも既存のウォレットを復元する場合でも、初回同期ではウォレットの履歴全体に対するフィルターを取得します。この一回限りの処理は、インターネット接続速度により**5〜30分**かかることがあります。
2. 🚀 **既に同期済みのウォレットを開く：** Bitcoin Safeは前回のセッション以降の最新フィルターのみを取得すればよいため、その追いつき処理は通常**30秒未満**で完了します。
3. 🔄 **ElectrumサーバーからCBFへ切り替える場合：** ウォレットが以前Electrumサーバーで同期されていた場合、Bitcoin Safeは最新のフィルターだけを取得すればよく、通常**30秒未満**です。

### 未確認の支払いについて把握する

コンパクトブロックフィルターは**確認済みブロック**のみをカバーします。確認前の着信取引について通知を受けたい場合は、[インスタント取引通知]({{< ref "knowledge/instant-transactions-notifications/" >}})も有効にしてください。この機能はランダムなBitcoinノードからのライブなピアツーピアメッセージを監視するため、プライバシーを犠牲にせずにメンプールの活動に反応できます。


<br>
<br>



### 技術的な詳細


- *さらに詳しく知りたい開発者向け：* コンパクトブロックフィルターは[BIP158仕様](https://bips.dev/158/)に従っており、[Elle MoutonによるGolomb-coded setsの概説](https://ellemouton.com/posts/bip158/)でも詳述されています。Bitcoin Safeの実装はオープンソースの[BDK向けKyotoコンパクトブロックフィルターモジュール](https://github.com/2140-dev/kyoto)に依存しています。
- 自分のBitcoin Coreノードをコンパクトブロックフィルター同期のピアに追加することもできます。_ビットコインネットワーク監視_の設定で _初期ノード_ を選択してください。


![](inital-node.png)
{ .img-fluid .mb-5   style="max-width: 414px;" }