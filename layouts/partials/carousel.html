{{/* Reusable carousel partial.
     Accepts:
       - resources: slice of page resources (images/videos)
       - path/base: filesystem path and base URL prefix (fallback)
       - id: optional unique carousel id (defaults to carouselExampleAutoplaying)
*/}}
{{ $id := or .id "carouselExampleAutoplaying" }}
{{ $imgExts   := slice ".jpg" ".jpeg" ".png" ".gif" ".webp" ".avif" }}
{{ $videoExts := slice ".mp4" ".webm" ".ogg" ".mkv" }}

{{ $items := slice }}
{{ $useResources := false }}
{{ $base := .base }}

{{ if .resources }}
  {{ $useResources = true }}
  {{ $items = .resources }}
{{ else if .path }}
  {{ $items = readDir .path }}
{{ else if .folder }}
  {{ $path := printf "static/%s/" .folder }}
  {{ $items = readDir $path }}
  {{ if not $base }}
    {{ $base = printf "/%s/" .folder }}
  {{ end }}
{{ end }}

<div class="row justify-content-center text-center mt-lg-3">
  <div id="{{ $id }}" 
       class="carousel carousel-dark slide" 
       data-bs-ride="carousel" 
       style="width: 100%; max-width: 899px;">
    <div class="carousel-inner">
      {{ range $i, $item := $items }}
        {{ $ext := "" }}
        {{ if $useResources }}
          {{ $ext = lower (path.Ext $item.Name) }}
        {{ else }}
          {{ $ext = lower (path.Ext $item.Name) }}
        {{ end }}
        <div class="carousel-item {{ if eq $i 0 }}active{{ end }}">
          {{ if in $imgExts $ext }}
            <img 
              src="{{ if $useResources }}{{ $item.RelPermalink }}{{ else }}{{ printf "%s%s" $base $item.Name }}{{ end }}"
              class="d-block w-100" 
              alt="{{ $item.Name }}">
          {{ else if in $videoExts $ext }}
            {{ $type := printf "video/%s" (replace $ext "." "" ) }}
            <video autoplay muted loop playsinline class="d-block w-100">
              <source 
                src="{{ if $useResources }}{{ $item.RelPermalink }}{{ else }}{{ printf "%s%s" $base $item.Name }}{{ end }}"
                type="{{ $type }}">
              Your browser does not support the video tag.
            </video>
          {{ else }}
            <p class="text-danger">Unsupported file “{{ $item.Name }}”</p>
          {{ end }}
        </div>
      {{ end }}
    </div>

    <button class="carousel-control-prev" 
            type="button" 
            data-bs-target="#{{ $id }}" 
            data-bs-slide="prev">
      <span class="carousel-control-prev-icon" 
            aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" 
            type="button" 
            data-bs-target="#{{ $id }}" 
            data-bs-slide="next">
      <span class="carousel-control-next-icon" 
            aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>
