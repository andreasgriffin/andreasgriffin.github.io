{{ $videos := .videos }}
{{ $page := .Page }}
{{ if $videos }}
  <div class="container my-5">
    <div class="row">
      {{ range $videos }}
        {{ $video := . }}
        {{ if eq (printf "%T" $video) "string" }}
          {{ $video = dict "url" $video }}
        {{ end }}

        {{ $videoUrl := $video.url }}
        {{ $name := $page.Title }}
        {{ $desc := $page.Params.description }}
        {{ with $video.name }}{{ $name = . }}{{ end }}
        {{ with $video.description }}{{ $desc = . }}{{ end }}

        {{/* --- uploadDate as ISO-8601 with timezone --- */}}
        {{ $uploadTime := now }}
        {{ with $page.Date }}{{ $uploadTime = . }}{{ end }}
        {{ with $video.uploadDate }}{{ $uploadTime = time . }}{{ end }}
        {{ $upload := time.Format "2006-01-02T15:04:05Z07:00" $uploadTime }}

        {{/* --- robust YouTube ID extraction --- */}}
        {{ $id := replaceRE `(?i)^.*(?:v=|youtu\.be/|shorts/|embed/)([A-Za-z0-9_-]{11}).*$` `$1` $videoUrl }}
        {{ if ne (len $id) 11 }}
          {{ $m := findRE `[A-Za-z0-9_-]{11}` $videoUrl }}
          {{ if gt (len $m) 0 }}{{ $id = index $m 0 }}{{ end }}
        {{ end }}

        {{ $embedUrl := printf "https://www.youtube-nocookie.com/embed/%s" $id }}

        <div class="col-md-12 mb-4 text-center">
          <div class="ratio ratio-16x9" style="max-width:800px; margin:0 auto;">
            <iframe src="{{ $embedUrl }}"
                    title="{{ $name }}"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin"
                    allowfullscreen>
            </iframe>
          </div>
        </div>

        {{/* --- single thumbnail URL --- */}}
        {{ $thumb := printf "https://i.ytimg.com/vi/%s/hqdefault.jpg" $id }}

        {{/* --- JSON-LD VideoObject --- */}}
        {{ if eq (len $id) 11 }}
          {{ $schema := dict
              "@context" "https://schema.org"
              "@type" "VideoObject"
              "name" $name
              "description" $desc
              "thumbnailUrl" $thumb
              "embedUrl" $embedUrl
              "url" $videoUrl
              "contentUrl" $videoUrl
              "uploadDate" $upload
          }}
          <script type="application/ld+json">
          {{ $schema | jsonify | safeJS }}
          </script>
        {{ end }}
      {{ end }}
    </div>
  </div>
{{ else }}
  <p>No videos provided.</p>
{{ end }}
